---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r}

library("readxl")
library("tidyverse")
library("dplyr")
library("glue")
library("ggplot2")
library("DescTools")

```

```{r}

dados <- read_csv("~/Cursos de Dados/estatistica com R/esatistica/dados.csv")


```

```{r}

# apresentando o mínimo e o máximo de uma variável com sprintf

sprintf('De %s até %s anos', min(dados$Idade), max(dados$Idade))

# outra forma de fazer: 

glue('De {min(dados$Idade)} até {max(dados$Idade)} anos')

```

```{r}

# distribuição de frequências

table(dados$Sexo)
```
```{r}

# porcentagem 

prop.table(table(dados$Sexo))*100 
```
```{r}

# tabelinha de frequência

dist_freq_qualitativas <- cbind(freq = table(dados$Sexo), percent = prop.table(table(dados$Sexo))*100)

dist_freq_qualitativas

```
```{r}

# renomeando o título das variáveis na tabela: 

colnames(dist_freq_qualitativas) <- c("Frequência", "Porcentagem (%)")

rownames(dist_freq_qualitativas) <- c("Masculino", "Feminino")

dist_freq_qualitativas

```

```{r}

# Distribuição de frequência variáveis qualitativas 

frequencia <- table(dados$Sexo, dados$Cor)

rownames(frequencia) <- c("Masculino", "Feminino")
colnames(frequencia) <- c("indigena", "Branca", "Preta", "Amarela", "Parda")

frequencia <- cbind(frequencia)

frequencia

# percentual 

percentual <- prop.table(frequencia)*100 
percentual



```


```{r}

# Renda média por cor de pele

medias <- tapply(dados$Renda, list(dados$Sexo, dados$Cor), mean)

rownames(medias) <- c("Masculino", "Feminino")
colnames(medias) <- c("indigena", "Branca", "Preta", "Amarela", "Parda")

medias

```

```{r}

# distribuição de frequencia para variáveis quantitativas (classes personalizadas)


classes <- c(0, 1576, 3152, 7880, 15760, 20000)
labels <- c("E", "D", "C", "B", "A")

frequencia <- table (cut(
  x = dados$Renda,
  breaks = classes, 
  labels = labels, 
  include.lowest = TRUE))

frequencia

# percentual

percentual <- prop.table(frequencia)*100
percentual

# juntando as tableas de freq. e percentual: 

dist_freq_quantitativas_personalizadas <- cbind('Frequência' = frequencia, 'Percentual(%)' = percentual)

dist_freq_quantitativas_personalizadas


# ordenando as classes: 


dist_freq_quantitativas_personalizadas[order(row.names(dist_freq_quantitativas_personalizadas)),]

```


```{r}


# outro exemplo usando altura 

classes <- c(min(dados$Altura), 1.65, 1.75, max(dados$Altura))

labels <- c('1 - Baixa', '2 - Média', '3 - Alta')

frequencia <- table(
    cut(
        x = dados$Altura,
        breaks = classes,
        labels = labels,
        include.lowest = TRUE
    )
)

percentual <- prop.table(frequencia) * 100

dist_freq_altura <- cbind('Frequência' = frequencia, 'Porcentagem (%)' = percentual)

dist_freq_altura[
    order(row.names(dist_freq_altura)),
]
```

```{r}

# histogramas básico do R: 

hist(
  x = dados$Altura, 
  col = "lightblue",
  main = "histograma das Alturas", 
  xlab = "Altura",
  ylab = "Frequências")


```


```{r}

# histogram com ggplot 

ggplot(dados, aes(x = Altura, y = ..density..))+
  geom_histogram(binwidth = 0.02, color = "black", alpha = 0.9)+
  geom_density(color = "red")+
  xlab ("Altura") +
  ylab ("Frequências") + 
  ggtitle("Histograma das Alturas") +
  theme_minimal()+
  theme(
    plot.title = element_text(size = 12, hjust = 0.5), 
    axis.title.y = element_text(size = 10, vjust = 0.2),
    axis.title.x = element_text(size = 10, vjust = 0.2),
    axis.text.y = element_text(size = 10), 
    axis.text.x = element_text(size = 10)
    
  )

```


```{r}

# salvando o formato do gráfico numa variável

formato <-  theme_minimal()+
  theme(
    plot.title = element_text(size = 12, hjust = 0.5), 
    axis.title.y = element_text(size = 10, vjust = 0.2),
    axis.title.x = element_text(size = 10, vjust = 0.2),
    axis.text.y = element_text(size = 10), 
    axis.text.x = element_text(size = 10)
    
  )

```



```{r}

# geom bar 

bar_chart <- data.frame(dist_freq_quantitativas_personalizadas)

ggplot(bar_chart, aes(x = row.names(bar_chart), y = bar_chart$Frequência))+
  geom_bar(stat = 'identity')+ 
  ylab('Frequêcia') +
  xlab('Classes de Renda')+
  ggtitle("Gráfico Classes de Renda") +
  formato
  


```

Medidas de tendência central 

```{r}

# Data frame de exemplo: 

materias <- c("Matematica", "Português", "Inglês", "Geografia", "Historia", "Física", "Quimica")

Fulano <- c (8, 10, 4, 8, 6, 10, 8)
Beltrano <- c (10, 2, 0.5, 1, 3, 9.5, 10)
Sicrano <- c (7.5, 8, 7, 8, 8, 8.5, 7)

df <- data.frame(Fulano, Beltrano, Sicrano, row.names = materias)

df


```
```{r}

# média

(8 + 10 + 4 + 8 +  6 + 10 + 8) / 7

mean(df$Fulano)

```

```{r}

# criando uma função para obter a média

Media <- function(x) { 
    media <- sum(x) / length(x) 
    return(media) 
}

# utilizando a função 


Media(dados$Renda)

```


```{r}

mean(dados$Renda)

# renda média dos homens e das mulheres: 

aggregate(list(Renda = dados$Renda), list(Sexo = dados$Sexo), mean)

```
Mediana passo a passo: 

1. ordenar o conjunto de dados
2. identificar o número de observações (registros) do conjunto de dados
3. Identificar o elemento mediano 
4. Quando n for impar a posição do elemento mediano será obtido da seguinte forma: n + 1 /2 
5. Quando n for par a posição do elemento mediano é obtida: n/2 
6. 

```{r}

# mediana

# ordenando os dados

df_fulano <- df[order(df$Fulano),]
df_fulano 

# obtendo o elemento mediano: 

n = nrow(df_fulano)
n 

elemento_md <- (n + 1)/2
elemento_md

df_fulano[elemento_md, ]

# função para a mediana 

median(df$Fulano)
```

A moda é mais usada para dados qualitativos, é o valor mais frequente. 

```{r}

exemplo_moda <- c(1, 2, 2, 3, 4, 4, 5, 6, 7, 7)

exemplo_moda 


# função para obter a moda (apresenta os numeros frequentes e a quantidade em que aparecem)

freq <- table(exemplo_moda)
freq[freq == max(freq)]

# para obter apenas os numeros mais frequentes: 

names(freq)[freq == max(freq)]

# criando uma função para obter a moda: 

Moda <- function(x) {
  freq <- table(x)
  return(names(freq)[freq == max(freq)])
  
}


# utilizando a função: 

Moda(exemplo_moda)

Moda(dados$Renda)

Moda(dados$Altura) # geralmente dados quanti.contínuos tem várias modas

```

Relações entre medidas de tendência central 

```{r}

# avaliando a variável renda 

ggplot(dados[dados$Renda < 20000, ], aes(x = Renda, y = ..density..)) +    geom_histogram(binwidth = 500) + 
   geom_density(color = "red") + 
   formato

```

A relação MODA < MEDIANA < MÉDIA indica que a distribuição é assimétrica à direita: 

```{r}

moda <- as.numeric(Moda(dados$Renda))
moda

```

```{r}

mediana <- median(dados$Renda)
mediana

```

```{r}

Media <- mean(dados$Renda)
Media

```
```{r}

# avaliando a variável altura 
# A relação MODA = MEDIANA = MÉDIA indica que a distribuição é simétrica

ggplot(dados, aes(x = Altura, y = ..density..)) + 
  geom_histogram() + 
  geom_density(color = "red") + 
  formato


```


```{r}

moda <- as.numeric(Moda(dados$Altura))
moda

```

```{r}

mediana <- median(dados$Altura)
mediana

```

```{r}
 
media <- mean(dados$Altura)
media

```

Quartis, decis e percentis - ajudam a entender a tendência central dos dados

quartis: dividem a série de dados em quatro partes iguais
decis: dez partes iguais
percentis: cem partes iguais 


```{r}

# Quartil: 

quantile(dados$Renda, c(0.25, 0.5, 0.75))


```

```{r}

# Decis: 

decis <- c()
for(i in 1:9){
  decis <- c(decis, i/10)
}

quantile(dados$Renda, decis)

```

```{r}

# centis 
 

centis <- c()
for(i in 1:99){
  centis <- c(centis, i/100)
}

quantile(dados$Renda, centis)


```

```{r}

# Qual a renda máxima de 99% da população? 

quantile(dados$Renda, .99)

```


```{r}

ggplot(dados, aes(x = Idade)) +
  geom_histogram(aes(y = cumsum(..count..)/sum(..count..)), bins = 10) + 
  geom_freqpoly(aes(y = cumsum(..count..)/sum(..count..)), color = "red") +
  formato


```


```{r}

# Qual a pct de pessoas com 40 anos ou menos? 

length (dados$Idade[dados$Idade <= 40]) / length(dados$Idade)

```

Desvio Médio absoluto

```{r}

notas_fulano <- data.frame(Fulano = df$Fulano, row.names = row.names(df))

nota_media_fulano <- mean(notas_fulano$Fulano)
 
notas_fulano$Desvio <- notas_fulano$Fulano - nota_media_fulano

# tirando os valores negativo da variável desvio 

notas_fulano$Desvio.absoluto <- abs(notas_fulano$Desvio) 

notas_fulano

# média do desvio 

mean(notas_fulano$Desvio.absoluto)

# função do desvio padrão médio absoluto: 

MeanAD(df$Fulano)

```

Variância: desvio absoluto elevado ao quadrado divido pela quantidade de notas menos 1

```{r}

# Elevando o desvio ao quadrado pra obter a variância

notas_fulano$Desvio2 <- notas_fulano$Desvio^2

sum(notas_fulano$Desvio2) / (nrow(notas_fulano) - 1)

```

```{r}

# função da variância "var"

variancia <- var(notas_fulano$Fulano)
variancia

```


 Desvio padrão é a raiz quadrada da variância 
 
 
```{r}

# obtendo a raiz quadrada da variância: 

sqrt(variancia)

# usando uma função própria do R para desvio padrão 

desvio_padrao <- sd(notas_fulano$Fulano)
desvio_padrao

```

```{r}


dataset <- data.frame( 
    Sexo = c('H', 'M', 'M', 'M', 'M', 'H', 'H', 'H', 'M', 'M'), 
    Idade = c(53, 72, 54, 27, 30, 40, 58, 32, 44, 51) 
) 

dataset %>% filter(Sexo == "M") %>% 
  summarize(desvio_p = sd(Idade))


sd(dataset$Idade)
```

Distribuições de probabilidades: 

1. Distribuição Binomial 

Um experimento binomial tem duas características básicas: a) somente dois resultados são possíveis, como verdadeiro ou falso, cara ou coroa e; b) Todos os ensaios realizados precisam ter a mesma configuração.

```{r}

# Quantas combinações de 6 numeros eu consigo fazer num jogo com 60 numeros? 

combinações <- choose(60, 6) # a função choose serve pra ver quantas combinações será possível fazer 

# probabilidade de acertar a combinação correta com apenas uma tentativa: 

probabilidade <- 1/combinações
probabilidade # numero muito pequeno = chance muito pequena


```

Probleminha: Nesse novo jogo, o apostador marca 20 números, dentre os 25 disponíveis no bilhete, e pode ganhar até 1 milhão de reais.Determine qual o número de combinações possíveis desse experimento (espaço amostral)

```{r}

combinacoes <- choose(25, 20)
combinacoes

```

e a probabilidade de se ganhar o prêmio jogando apenas um bilhete (considere apenas quinze casas decimais).

```{r}

probabilidade <- 1/combinacoes
probabilidade

sprintf('Combinações = %d e Probabilidade = %0.15f', combinacoes, probabilidade)

```
Problema: Um dado de seis faces, não viciado, é lançado para o alto quatro vezes. Utilizando a distribuição binomial, obtenha a probabilidade de o dado cair com um número par voltado para cima duas vezes.

```{r}

p = 1 / 2   # Probabilidade de sair um número PAR
n = 4       # Total de lançamentos
k = 2       # Total de sucessos (número PAR voltado para cima)

dbinom(x = k, size = n, prob = p)

```

Um dado de seis faces, perfeitamente equilibrado, é lançado para o alto dez vezes. Utilizando a distribuição binomial, obtenha a probabilidade de o dado cair com o número 5 voltado para cima pelo menos três vezes.

```{r}

p = 1 / 6    # Probabilidade de sair o número CINCO
n = 10       # Total de lançamentos

pbinom(q = 2, size = n, prob = p, lower.tail = F)
```

Suponha que a probabilidade de se contrair o novo Coronavírus seja de 70%. Em um grupo de 1500 famílias, com 5 pessoas cada, quantas podemos esperar que tenham apenas dois contaminados?

```{r}

p <- 0.7
n <- 5
k <- 2
N <- 1500

probabilidade <- dbinom(k, n, p)

media <- probabilidade * N

round(media)


```

Distribuição de Poison 

É empregaa para descrever o número de ocorrências em um intervalo de tempo ou espaço específico. Os eventos são caracterizados pela possibilidade de contagem dos sucessos, mas não a possibilidade de contagem dos fracassos. 
Exemplos: o numero de clients que entram em uma loja em determinada hora, o número de carros que chegam em um drive-thru de uma lanchonete no horário de almoço...


```{r}

# Um restaurante recebe em média 20 pedidos por hora. Qual a chance de que, em determinada hora escolhida ao acaso ele receba 15 pedidos? 

# 1° parte: Qual o número médio de ocorrÊncias or hora? (mi)

media <- 20

# 2° parte: qual o número de ocorrência obtermos no período? (k)

k <- 15 

# Solução 1 (exp(1) é a constante necessária da fórmula)

probabilidade <- ((exp(1)**(- media))*(media**k))/(factorial(k))

# Solução 2 - com funcionalidade do R 

probabilidade <- dpois(x = k, lambda = media)
probabilidade

```


O número médio de clientes que entram em uma padaria por hora é igual a 20. Obtenha a probabilidade de, na próxima hora, entrarem exatamente 25 clientes

```{r}

media <- 20
k <- 25

probabilidade_2 <- dpois(x = k, lambda = media)*100
probabilidade_2


```

Distribuição normal

É uma das mais utilizadas, é uma distribuição contínua, onde a distribuição de frequências de uma variável quantitativa apresenta a forma de sino e é simétrica em relação a sua média (50% pra esquerda e 50% para a esquerda)

```{r}




```
















